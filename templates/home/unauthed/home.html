{% extends "base.html" %}

{% block content %}
<div class="" style="min-height: 50vh;">
	<div class="hero-section text-white text-center" style="background: url('/media/defaults/bocaue-river.jpg') no-repeat center/cover; padding: 5rem 1rem;">
	<h1 class="display-4 font-weight-bold">Welcome to Bocaue's Official Portal</h1>
	<p class="lead">Empowering Citizens Through Transparency & Service</p>
	<a href="#business-section" class="btn btn-primary btn-lg mt-3">Explore Services</a>
	</div>
    <div id="top" class="row">
        <!-- Left side -->
        <div class="col-lg-8 mx-auto">
            <!-- MAYOR'S MESSAGE VIDEO -->
            <div class="container my-3">
            <div class="embed-responsive embed-responsive-16by9 shadow">
                <iframe
                class="embed-responsive-item"
                src="https://www.youtube.com/embed/T-msx__xlXY"
                title="Tambalang Jonjon Villanueva at Atty. Sherwin Tugna, muling mauupo sa Bocaue, Bulacan"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen
                ></iframe>
            </div>
            </div>

        </div>

        <!-- RIGHT SIDE -->
        <div class="col-lg-4 mx-auto">
            <!-- PINNED + LATEST ANNOUNCEMENTS -->
            <div class="card border-warning my-3 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <strong><i class="fa fa-thumbtack"></i> Announcements</strong>
                </div>
                <ul class="list-group list-group-flush">
                    {% for announcement in announcements %}
                        {% if announcement.published and announcement.is_pinned %}
                        <li class="list-group-item">
                            <a href="{% url 'announcement-detail' announcement.slug %}">
                                <i class="fa fa-thumbtack text-danger"></i> {{ announcement.title|truncatechars:50 }}
                            </a>
                        </li>
                        {% endif %}
                    {% endfor %}

                    
                    {% for announcement in latest_public  %}
                      {% if not announcement.is_pinned %}
                        <li class="list-group-item">
                            <a href="{{ announcement.get_absolute_url }}">
                                <i class="fa fa-bullhorn text-primary"></i> {{ announcement.title|truncatechars:50 }}
                            </a>
                        </li>
                      {% endif %}
                    {% endfor %}
                </ul>
            </div>

            <div class="text-center my-4">
                <a href="{% url 'announcements-list' %}" class="btn btn-outline-primary">
                    View All Announcements
                </a>
            </div>
        </div>
	</div>

    <!-- BUSINESS SERVICES SECTION -->
    <section id="business-section" class="business-section py-5 bg-light my-3">
        <div class="col-lg-9 mx-auto DebugGreen">
            <div class="container my-3">
              <h2 class="text-center mb-4">Business Services</h2>
              <div class="row">
                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-md-4">
                      <div class="card shadow-sm mb-3">
                          <div class="card-body">
                              <h5 class="card-title">Start a Business</h5>
                              <p class="card-text">Step-by-step guide and requirements for business registration in Bocaue.</p>
                              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
                          </div>
                      </div>
                  </div>
                  <!-- Add more blocks for Permits, Renewals, etc. -->
              </div>
            </div>
        </div>      
    </section>

    <!-- CONTACT US SECTION -->
    <section id="contact-us" class="py-5 bg-light my-3">
    <div class="container">
        <h2 class="text-center mb-4">Contact Us</h2>
            <div class="row align-items-stretch">
                <!-- LEFT: Department Carousel -->
                <div class="col-md-6 d-flex">
                  <div class="card w-100 shadow-sm p-3">
                    <div id="departmentCarousel" class="carousel slide w-100" data-ride="carousel">
                      <div class="carousel-inner">
                        {% for dept in departments %}
                          <div class="carousel-item {% if forloop.first %}active{% endif %}" data-image="{{ dept.image.url }}">
                            <div class="card h-100">
                              <div class="position-relative p-2 h-100 d-flex flex-column justify-content-between">
                                <div class="ribbon-wrapper">
                                  <div class="ribbon bg-primary">
                                    <img src="../../media/defaults/jjv.png" style="height: 25px; position: absolute;">
                                  </div>
                                </div>
                                <div class="card-header">
                                  <h5>{{ dept.name }}</h5>
                                </div>
                                <div class="card-body flex-grow-1">
                                    <div class="contact-links">
                                        {% if dept.email %}
                                          <p class="mb-1">
                                            <i class="fas fa-envelope text-primary"></i>
                                            <strong class="ml-1">Email:</strong>
                                            <a href="mailto:{{ dept.email }}" class="text-decoration-none">{{ dept.email }}</a>
                                          </p>
                                        {% endif %}
                                      
                                        {% if dept.landline %}
                                          <p class="mb-1">
                                            <i class="fas fa-phone text-primary"></i>
                                            <strong class="ml-1">Landline:</strong>
                                            <a href="tel:{{ dept.landline|cut:' ' }}" class="text-decoration-none">{{ dept.landline }}</a>
                                          </p>
                                        {% endif %}
                                      
                                        {% if dept.mobile %}
                                          <p class="mb-1">
                                            <i class="fas fa-mobile-alt text-primary"></i>
                                            <strong class="ml-1">Mobile:</strong>
                                            <a href="tel:{{ dept.mobile|cut:' ' }}" class="text-decoration-none">{{ dept.mobile }}</a>
                                          </p>
                                        {% endif %}
                                      </div>
                                  
                                </div>
                                <div class="btn-secondary card-footer text-center text-primary">
                                  <a href="https://m.me/{{ dept.messenger_chat_link }}" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
                                    Or chat with us on <i class="fab fa-facebook-messenger text-primary"></i> Messenger
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                      <a class="carousel-control-prev" href="#departmentCarousel" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                      </a>
                      <a class="carousel-control-next" href="#departmentCarousel" role="button" data-slide="next">
                        <span class="carousel-control-next-icon"></span>
                      </a>
                    </div>
                  </div>
                </div>
              
                <!-- RIGHT: Image Display -->
                <div class="col-md-6 d-flex">
                  <div class="card w-100 shadow-sm p-3 d-flex justify-content-center align-items-center">
                    <div class="image-wrapper w-100">
                      <img id="dept-image-display"
                           src="{% if departments %}{{ departments.0.image.url }}{% endif %}"
                           class="img-fluid"
                           alt="Department Image">
                    </div>
                  </div>
                </div>
            </div>
    </div>
    </section>

    <!-- SCRIPT TO HANDLE IMAGE CHANGE -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const carousel = document.getElementById('departmentCarousel');
        const imageDisplay = document.getElementById('dept-image-display');

        if (carousel && imageDisplay) {
        $('#departmentCarousel').on('slid.bs.carousel', function () {
            const activeItem = carousel.querySelector('.carousel-item.active');
            const newImageUrl = activeItem.getAttribute('data-image');

            if (newImageUrl && newImageUrl !== imageDisplay.src) {
            imageDisplay.style.opacity = 0;

            setTimeout(() => {
                imageDisplay.src = newImageUrl;
                imageDisplay.style.opacity = 1;
            }, 250); // half of transition duration for fade
            }
        });
        }
    });
    </script>


</div>
{% endblock content %}